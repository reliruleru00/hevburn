<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ヘブバン</title>
  <link rel="stylesheet" href="css/modal.css">
  <link rel="stylesheet" href="css/damege.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>

    var chara_list = [
{"style_id":1,"style_name":"黎明のエモーショナル・ソウル","chara_id":1,"chara_name":"茅森　月歌","image_url":"RKayamoriDefault_R3a_Thumbnail.webp","troops":"31A","role":1,"type":1,"element":1,"ability1":1,"ability2":1},
{"style_id":2,"style_name":"終いのSpitfire","chara_id":2,"chara_name":"和泉　ユキ","image_url":"YIzumiDefault_R3_Thumbnail.webp","troops":"31A","role":2,"type":2,"element":0,"ability1":1,"ability2":1},
{"style_id":3,"style_name":"Ikki Burst Strike","chara_id":3,"chara_name":"逢川　めぐみ","image_url":"MAikawaDefault_R3_Thumbnail.webp","troops":"31A","role":5,"type":3,"element":0,"ability1":1,"ability2":1},
{"style_id":4,"style_name":"メメント・モリの美少女","chara_id":4,"chara_name":"東上　つかさ","image_url":"TTojoDefault_R3_Thumbnail.webp","troops":"31A","role":4,"type":2,"element":1,"ability1":1,"ability2":1},
{"style_id":5,"style_name":"紅蓮月華のKillrazor","chara_id":5,"chara_name":"朝倉　可憐","image_url":"KarenDefault_R3_Thumbnail.webp","troops":"31A","role":3,"type":1,"element":0,"ability1":1,"ability2":1},
{"style_id":6,"style_name":"気合一閃エンジェルセイラー","chara_id":6,"chara_name":"國見　タマ","image_url":"TKunimiDefault_R3_Thumbnail.webp","troops":"31A","role":6,"type":1,"element":0,"ability1":1,"ability2":1}];
    var skill_attack = [
{"skill_id":1,"skill_name":"夢幻泡影","chara_id":1,"style_id":0,"ref_status_1":1,"ref_status_2":2,"type":1,"element":0,"min_power":1602.00,"max_power":8010.00,"hit_count":9,"destruction":2.750,"sp_cost":12,"param_limit":138,"hp_damege":30,"dp_damege":0},
{"skill_id":2,"skill_name":"星火燎原","chara_id":1,"style_id":0,"ref_status_1":1,"ref_status_2":2,"type":1,"element":1,"min_power":2502.00,"max_power":12510.00,"hit_count":2,"destruction":3.5,"sp_cost":14,"param_limit":147,"hp_damege":30,"dp_damege":0},
{"skill_id":3,"skill_name":"流星","chara_id":2,"style_id":0,"ref_status_1":2,"ref_status_2":1,"type":2,"element":0,"min_power":1671.00,"max_power":8355.00,"hit_count":1,"destruction":2.6,"sp_cost":11,"param_limit":144,"hp_damege":0,"dp_damege":30},
  ];
    var chara_no;
    var select_style_list = [0, 0, 0, 0, 0, 0];
    var status_kbn = ["", "str", "dex", "con", "mnd", "int", "luk"];

  $(function(){ 
    $.each(chara_list, function(index, value) {
      let source = "img/" + value.image_url;
      let style_id = value.style_id;
      $("#sytle_list").append('<input type="image" class="select_style w-16 h-16" src="' + source + '" data-style_id="' + style_id + '"/>');
    });

    // var info =["レベル", "力", "器用さ", "体力", "精神", "知力", "運"];
    // $.each(info, function(index, value) {
      
    //   $("#char_list").append("<label>" + value + "</label>");
    //   for (var i = 0; i < 7; i++) {
    //     $("#char_list").append('<input type="number" step="1" id="level_' + i + '" value="130">');
    //   }
    // }

    // 計算
    $("#calc").on("click", function(event) {
      var kisoAtk = getKisoAtk();
      var buff = 1;
      var debuff = 1;
      var critical = 1;
      var ability = 1;
      var filed = 1;
      var weak_type = 1;
      var weak_element = 1;
      var special_dp = 1;
      var special_hp = 1;
      var destruction_rate = 1;
      var damage = Math.floor(kisoAtk * buff * debuff * 1.3);
      $("#damage").val(damage);
    })

    // モーダルを開く
    $('.showmodal').on('click', function(){
      chara_no = $(this).data("chara_no");
      $('.ModalLayer').addClass('isShow');
    });

    // モーダルを閉じる
    $('.select_style').on('click', function(){
      let style_id = $(this).data("style_id");
      let style = $.grep(chara_list,
        function (obj, index) {
          return (obj.style_id === style_id);
        });
      select_style_list[chara_no] = style[0];
      $('[data-chara_no="' + chara_no + '"]').attr("src", "img/" + style[0].image_url);
      chara_no = 0;
      createAttackList();
      $('.ModalLayer').removeClass('isShow');
    });
  });

  function createAttackList() {
    $("#skill_list").html("");
    $.each(select_style_list, function(index1, value) {
      let chara_id = value.chara_id;
      let style_id = value.style_id;
      let skill_list = $.grep(skill_attack,
        function (obj, index) {
          return (obj.chara_id === chara_id && (obj.style_id === style_id || obj.style_id == 0));
        });
        $.each(skill_list, function(index2, value) {
          $("#skill_list").append("<option value='" + value.skill_id +"' data-chara_no='" + index1 +"'>" + value.skill_name + "</option>");
        });
    });
   }
 
  function getKisoAtk() {
      let chara_no = $("#skill_list option:selected").data("chara_no");
      let skill_id = Number($("#skill_list option:selected").val());
      let skill_info = $.grep(skill_attack,
        function (obj, index) {
          return (obj.skill_id === skill_id);
        })[0];

      let attack;
      let status1 = Number($("#" + status_kbn[skill_info.ref_status_1] + "_" + chara_no).val());
      if (skill_info.ref_status_2 == 0) {
        attack = status1;
      } else {
        let status2 = Number($("#" + status_kbn[skill_info.ref_status_2] + "_" + chara_no).val());
        attack = (status1 * 2 + status2) / 3;
      }
      let emeny_stat = Number($("#emeny_stat").val());
      let skill_lv = Number($("#skill_lv option:selected").val()) - 1;
      let min_power = skill_info.min_power + (skill_info.min_power / 20 * skill_lv);
      min_power = 2506;
      let max_power = skill_info.max_power + (skill_info.max_power / 50 * skill_lv);
      max_power = 10026;
      let skill_stat = skill_info.param_limit;
      skill_stat = 144;
      let kisoAtk;
      if (emeny_stat - skill_stat / 2 > attack){
        kisoAtk = 1;
      } else if (emeny_stat > attack){
        kisoAtk = min_power / (skill_stat - 2) * (attack - (emeny_stat - skill_stat / 2));
      } else {
        kisoAtk = (max_power - min_power) / skill_stat * (attack - emeny_stat) + min_power;
      }
      return kisoAtk;
    }

  </script>
</head>
<body>
  <header>

  </header>
  <div>
    <div class="w-[768px] mx-auto">
      <div>
        <label>敵ステータス</label>
        <label>名前</label>
        <input type="text" id="emeny_name" value="200">
        <input type="text" id="emeny_stat" value="320">
      </div>
      <div id="char_list" class="grid grid-cols-7 text-center">
          <div>
          <label>キャラクター</label>
          </div>
          <img class="showmodal w-16 h-16" id="chara0" src="img/plus.png" data-chara_no="0">
          <img class="showmodal w-16 h-16" id="chara1" src="img/plus.png" data-chara_no="1">
          <img class="showmodal w-16 h-16" id="chara2" src="img/plus.png" data-chara_no="2">
          <img class="showmodal w-16 h-16" id="chara3" src="img/plus.png" data-chara_no="3">
          <img class="showmodal w-16 h-16" id="chara4" src="img/plus.png" data-chara_no="4">
          <img class="showmodal w-16 h-16" id="chara5" src="img/plus.png" data-chara_no="5">
          <label>レベル</label>
          <input type="number" step="1" id="level_0" value="130">
          <input type="number" step="1" id="level_1" value="130">
          <input type="number" step="1" id="level_2" value="130">
          <input type="number" step="1" id="level_3" value="130">
          <input type="number" step="1" id="level_4" value="130">
          <input type="number" step="1" id="level_5" value="130">
          <label>凸数</label>
          <input type="number" step="1" id="convex_0" value="2">
          <input type="number" step="1" id="convex_1" value="2">
          <input type="number" step="1" id="convex_2" value="2">
          <input type="number" step="1" id="convex_3" value="2">
          <input type="number" step="1" id="convex_4" value="2">
          <input type="number" step="1" id="convex_5" value="2">
          <label>力</label>
          <input type="number" step="1" id="str_0" value="200">
          <input type="number" step="1" id="str_1" value="343">
          <input type="number" step="1" id="str_2" value="200">
          <input type="number" step="1" id="str_3" value="200">
          <input type="number" step="1" id="str_4" value="200">
          <input type="number" step="1" id="str_5" value="200">
          <label>器用さ</label>
          <input type="number" step="1" id="dex_0" value="200">
          <input type="number" step="1" id="dex_1" value="420">
          <input type="number" step="1" id="dex_2" value="200">
          <input type="number" step="1" id="dex_3" value="200">
          <input type="number" step="1" id="dex_4" value="200">
          <input type="number" step="1" id="dex_5" value="200">
          <label>体力</label>
          <input type="number" step="1" id="con_0" value="200">
          <input type="number" step="1" id="con_1" value="200">
          <input type="number" step="1" id="con_2" value="200">
          <input type="number" step="1" id="con_3" value="200">
          <input type="number" step="1" id="con_4" value="200">
          <input type="number" step="1" id="con_5" value="200">
          <label>精神</label>
          <input type="number" step="1" id="mnd_0" value="200">
          <input type="number" step="1" id="mnd_1" value="200">
          <input type="number" step="1" id="mnd_2" value="200">
          <input type="number" step="1" id="mnd_3" value="200">
          <input type="number" step="1" id="mnd_4" value="200">
          <input type="number" step="1" id="mnd_5" value="200">
          <label>知力</label>
          <input type="number" step="1" id="int_0" value="200">
          <input type="number" step="1" id="int_1" value="200">
          <input type="number" step="1" id="int_2" value="200">
          <input type="number" step="1" id="int_3" value="200">
          <input type="number" step="1" id="int_4" value="200">
          <input type="number" step="1" id="int_5" value="200">
          <label>運</label>
          <input type="number" step="1" id="luk_0" value="200">
          <input type="number" step="1" id="luk_1" value="200">
          <input type="number" step="1" id="luk_2" value="200">
          <input type="number" step="1" id="luk_3" value="200">
          <input type="number" step="1" id="luk_4" value="200">
          <input type="number" step="1" id="luk_5" value="200">
          <label>宝珠レベル</label>
          <input type="number" step="1" id="jewel_0" value="5">
          <input type="number" step="1" id="jewel_1" value="5">
          <input type="number" step="1" id="jewel_2" value="5">
          <input type="number" step="1" id="jewel_3" value="5">
          <input type="number" step="1" id="jewel_4" value="5">
          <input type="number" step="1" id="jewel_5" value="5">
          <label>スキル</label>
          <div id="buff_list_0"></div>
          <div id="buff_list_1"></div>
          <div id="buff_list_2"></div>
          <div id="buff_list_3"></div>
          <div id="buff_list_4"></div>
          <div id="buff_list_5"></div>
        </div>
        <div class="w-96 mx-auto">
          <div class="flex">
            攻撃スキル
            <select id="skill_list" class="w-60">
            </select>
            Lv
            <select id="skill_lv" class="w-12">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
            </select>
          </div>
          <br>
          <div class="w-64 mx-auto text-center">
            <input type="button" id="calc" href="javascript:void(0)" class="btn btn--orange btn--radius" value="計 算">
          </div>
          <br>
          <label>ダメージ</label>
          <input type="text" id="damage" value="">
        </div>
      </div>
    </div>
  </div>
  <div class="ModalLayer">
    <div class="ModalLayer-Mask"></div>
    <div class="ModalLayer-Inner">
      <div class="ModalSection">
        <div class="Modal">
          <div class="Modal-Inner">
            <div class="Modal-Inner-Headline">
              スタイル選択
            </div>
            <div id="sytle_list" class="grid grid-cols-8">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer>
  </footer>
</body>
</html>
