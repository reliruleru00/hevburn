<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ヘブバン ダメージ計算機</title>
  <link rel="stylesheet" href="css/modal.css">
  <link rel="stylesheet" href="css/damege.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="js/chara_name.js"></script>
  <script src="js/chara_style.js"></script>
  <script src="js/damege.js"></script>
  <script src="js/modal.js"></script>
  <script src="js/skill_attack.js"></script>
  <script src="js/skill_buff.js"></script>
  <script src="js/ability.js"></script>
  <script src="js/enemy.js"></script>
  <script>

    var chara_no;
    var select_style_list = [0, 0, 0, 0, 0, 0];
    var status_kbn = ["", "str", "dex", "con", "mnd", "int", "luk"];
    var type_physical = ["", "slash", "stab", "strike"];
    var type_element = ["none", "fire", "ice", "thunder", "light", "dark"];
    var select_attack_skill;

    $(function(){ 
      // スタイルリスト作成
      createStyleList();
      // モーダル系イベント追加
      addModalEvent();

      $("input[type='number']").prop("step", 1);
      $(".status").prop("max", 999);
      $(".status").prop("min", 1);

      $(".limit").each(function(index, value) {
        for (let i = 0; i <= 4; i++) $(value).append($('<option>').text(i).val(i))
        $(value).prop("selectedIndex", 2);
      });
      $(".jewel").each(function(index, value) {
        for (let i = 0; i <= 5; i++) $(value).append($('<option>').text(i).val(i))
        $(value).prop("selectedIndex", 5);
      });

      createEnemyList("1");
      $("#enemy_class").on("change", function(event) {
        let enemy_class = $("#enemy_class option:selected").val();
        createEnemyList(enemy_class);
      })
      $("#enemy_list").on("change", function(event) {
        setEnemyStatus();
        if (isWaek(undefined, undefined)) {
          $(".row_weak").css("display", "table-cell");      
        } else {
          $(".row_weak").css("display", "none");      
        }
      });

      // 限界突破変更
      $(".limit").on("change", function(event) {
        let limit_count = Number($(this).val());
        let chara_no = $(this).attr("id").replace("limit_", "");
        if (select_style_list[chara_no] == 0) {
          return;
        }
        let chara_id = "chara_id-" + select_style_list[chara_no].chara_id;
        $("input[type=checkbox]." + chara_id).each(function(index, value) {
          let ability_id = $(value).data("ability_id");
          let ability_info = getAbilityInfo(ability_id); 
          let limit_border = Number($(value).data("limit_border"));
          setAbilityCheck(value, ability_info, limit_border, limit_count);
        });
      });

      // 計算
      $("#calc").on("click", function(event) {
        // 攻撃スキル未設定
        let skill_info = getAttackInfo();
        if (skill_info === undefined) {
          alert("攻撃スキルが設定されていません");
          return;
        }
        // 闘志
        let fightingspirit = $("#fightingspirit").prop("checked") ? -20 : 0;
        // 厄
        let misfortune = $("#misfortune").prop("checked") ? -20 : 0;

        let basePower = getBasePower(fightingspirit + misfortune);
        let buff = getSumBuffEffectSize();
        let mindeye = isWaek() ? 1 + getSumEffectSize("mindeye") / 100 : 1;
        let funnel = 1 + getSumEffectSize("funnel") / 100;
        let debuff = getSumDebuffEffectSize();
        let fragile = isWaek() ? 1 + getSumEffectSize("fragile") / 100 : 1;
        let element_field = 1 + getSumEffectSize("element_field") / 100;
        let weak_physical = $("#enemy_physical_" + skill_info.attack_physical).val() / 100;
        let weak_element = $("#enemy_element_" + skill_info.attack_element).val() / 100;
        let destruction_rate = Number($("#enemy_destruction").val()) / 100;
        let special = 1 + (destruction_rate == 1 ? skill_info.dp_damege / 100 : skill_info.hp_damege / 100);

        let criticalPower = getBasePower(fightingspirit - 50);
        let criticalRate = getCriticalRate();
        let criticalBuff = getCriticalBuff();

        let damage = basePower * buff * mindeye * funnel * debuff * fragile * element_field * weak_physical * weak_element * special * destruction_rate;
        let critical_damage = criticalPower * buff * mindeye * funnel * debuff * fragile * element_field * weak_physical * weak_element * special * destruction_rate * criticalBuff;
        $("#damage").val(Math.floor(damage).toLocaleString());
        $("#damage_min").val(Math.floor(damage * 0.9).toLocaleString());
        $("#damage_max").val(Math.floor(damage * 1.1).toLocaleString());
        $("#critical_damage").val(Math.floor(critical_damage).toLocaleString());
        $("#critical_damage_min").val(Math.floor(critical_damage * 0.9).toLocaleString());
        $("#critical_damage_max").val(Math.floor(critical_damage * 1.1).toLocaleString());
        $("#critical_rate").text("(発生率:" + criticalRate + "%)");
        $("#damage_result").show();
      });

      // 攻撃スキル変更
      $("#attack_list").on("change", function(event) {
        if (select_attack_skill !== undefined) {
          if (select_attack_skill.attack_element !== 0) {
            $(".buff_element-" + select_attack_skill.attack_element).hide();
          }
          $("." + type_physical[select_attack_skill.attack_physical]).removeClass("selected");
          $("." + type_element[select_attack_skill.attack_element]).removeClass("selected");
          $(".status_attack_skill").removeClass("status_attack_skill");
        }
        if ($("#attack_list option").length == 0)  {
          $("#attack_physical").attr("src", "img/blank.png");
          $("#attack_element").attr("src", "img/blank.png");
          // 選択無しの場合は、削除のみ
          return;
        }
        let skill_info = getAttackInfo();
        let max_lv = skill_info.max_lv;
        let chara_no = $(this).find("option:selected").data("chara_no");
        let chara_id = "chara_id-" + skill_info.chara_id;
        $(".buff_element-" + skill_info.attack_element).show();
        $(".ability_self").hide();
        if (skill_info.attack_element !== 0) {
          $(".self_element-" + skill_info.attack_element + "." + chara_id).show();
          $("#elememt_ring").prop("disabled", false);
        } else {
          $("#elememt_ring").prop("disabled", true);
          $("#elememt_ring").prop("selectedIndex", 0);
        }
        $(".self_element-0." + chara_id).show();
        // 該当ステータスに着色
        for (let i = 1; i <=3; i++) {
          $("#" + status_kbn[skill_info["ref_status_" + i]] + "_" + chara_no).addClass("status_attack_skill");
        }

        $("input[type=checkbox].ability").each(function(index, value) {
          let ability_id = $(value).data("ability_id");
          let chara_no = $(value).data("chara_no");
          let ability_info = getAbilityInfo(ability_id); 
          let limit_border = Number($(value).data("limit_border"));
          let limi_count = Number($("#limit_" + chara_no).val());
          setAbilityCheck(value, ability_info, limit_border, limi_count);
        });
        $(".element").each(function(index, value) {
          select2ndSkill($(value));
        });
        let attack_physical = type_physical[skill_info.attack_physical];
        let attack_element = type_element[skill_info.attack_element];
        $("#attack_physical").attr("src", "img/" + attack_physical + ".webp");
        $("#attack_element").attr("src", "img/" + attack_element + ".webp");
        $("." + attack_physical).addClass("selected");
        $("." + attack_element).addClass("selected");
        
        if (skill_info.attack_element == 0) {
          $(".row_element").css("display", "none");      
        } else {
          $(".row_element").css("display", "table-cell");      
        }
        if (isWaek(skill_info, undefined)) {
          $(".row_weak").css("display", "table-cell");      
        } else {
          $(".row_weak").css("display", "none");      
        }
        select_attack_skill = skill_info;
        createSkillLvList("skill_lv", max_lv, max_lv);
      });
      // バフスキル変更
      $(".include_lv").on("change", function(event) {
        let index = $(this).prop("selectedIndex");
        let id = $(this).prop("id");
        $(".status_" + id).removeClass("status_" + id);
        if (index == 0) {
          resetSlillLv($(this).prop("id"));
        } else {
          let option = $(this).children().eq(index);
          let select_lv = option.data("select_lv");
          let skill_info = getBuffIdToBuff(Number(option.val()));
          createSkillLvList(id + "_lv", skill_info.max_lv, select_lv);
          setStatusToBuff(option, id);
        }
      });
      // スキルレベル変更
      $(".lv_effect").on("change", function(event) {
        let buff_type_id = $(this).attr("id").replace("_lv", "");
        let option = $("#" + buff_type_id + " option:selected");
        let chara_no = option.data("chara_no");
        let chara_id = select_style_list[chara_no].chara_id;
        let buff_id = Number(option.val());
        let skill_lv = $(this).prop("selectedIndex") + 1;
        // バフ効果量更新
        $(".variable_effect_size.chara_id-" + chara_id + ".buff_id-" + buff_id).each(function(index, value) {
          updateBuffEffectSize($(value), skill_lv);
        });
        // 同一スキル別セレクトボックス含めて反映
        $.each($(".chara_id-" + chara_id + ".buff_id-" + buff_id), function(index, value) {
          if ($(value).prop("selected")) {
            $("#" + $(value).parent().attr("id") +"_lv").prop("selectedIndex", skill_lv - 1);
          }
        });
      });
      // 宝珠レベル変更
      $(".jewel").on("change", function(event) {
        let chara_no = $(this).attr("id").replace(/[^0-9]/g, '');
        let chara_id = select_style_list[chara_no].chara_id;
        $(".variable_effect_size.chara_id-" + chara_id).each(function(index, value) {
          updateBuffEffectSize($(value));
        });
      });
      // ステータス変更
      $(".status.effect_size").on("change", function(event) {
        let chara_no = $(this).attr("id").replace(/[^0-9]/g, '');
        let chara_id = select_style_list[chara_no].chara_id;
        $(".variable_effect_size.chara_id-" + chara_id).each(function(index, value) {
          updateBuffEffectSize($(value));
        });
      });
    });

    // アビリティ追加
    function addAbility(style_info, chara_no) {
      let ability_list = [style_info.ability0, style_info.ability1, style_info.ability3];
      $.each(ability_list, function(index, value) {
        ability_id = value;
        if (ability_id == 0 || ability_id > 1000) {
          // 1000番以降は不要
          return true;
        }
        ability_info = getAbilityInfo(ability_id);
        let limit_count = Number($("#limit_" + chara_no).val());
        let limit_border = index == 0 ? 0 : (index == 1 ? 1 : 3); 
        let display = "none";
        if (ability_info.ability_element == 0 || (select_attack_skill !== undefined && select_attack_skill.attack_element === ability_info.ability_element)) {
          display = "block"
        }
        let target;
        let element_type;
        let disabled = ability_info.ability_type == 1 ? true : false;
        let checked = true;
        switch (ability_info.ability_target) {
          case 0: // フィールド
            addElementFiled(style_info, ability_info.ability_name, ability_info.ability_power, ability_info.ability_element);
            break;
          case 1: // 自分
            if (select_attack_skill !== undefined && select_attack_skill.chara_id !== style_info.chara_id) {
              display = "none"
            }
            target = "ability_self";
            element_type = "self_element"
            break;
          case 2: // 前衛
            target = "ability_front";
            element_type = "buff_element"
            break;
          case 3:	// 常時
          case 4: // その他
            target = "ability_all";
            element_type = "buff_element"
            break;
          default:
            break;
        }
        let name = chara_name[style_info.chara_id];
        let effect_size = ability_info.ability_power; 
        let id = target + style_info.chara_id;
        let chara_id = "chara_id-" + style_info.chara_id;
        let text = name + "：" +  ability_info.ability_name  + "(" + ability_info.ability_short_explan + ")";
        let input = $('<input>').attr("type", "checkbox").attr("id", id)
                .data("effect_size", effect_size)
                .data("limit_border", limit_border)
                .data("ability_id", ability_id)
                .data("chara_no", chara_no)
                .addClass("ability_element-" + ability_info.ability_element)
                .addClass("ability")
                .addClass(chara_id);
        let label = $('<label>').attr("for", id).text(text)
                .css("display", display)
                .addClass("checkbox01")
                .addClass(element_type + "-" + ability_info.ability_element)
                .addClass(target)
                .addClass(chara_id);
        setAbilityCheck(input, ability_info, limit_border, limit_count);
        $("#" + target).append(input).append(label);
      });
    }

    // バフ効果量更新
    function updateBuffEffectSize(option, skill_lv) {
      let buff_id = Number(option.val());
      if (skill_lv === undefined) {
        skill_lv = Number(option.data("select_lv"));
      }
      let chara_no = option.data("chara_no");
      let skill_buff = getBuffIdToBuff(buff_id);
      let effect_size = getEffectSize(skill_buff.buff_kind, buff_id, chara_no, skill_lv);
      let chara_id = select_style_list[chara_no].chara_id;
      let text = chara_name[chara_id] + "：" + skill_buff.buff_name + "　" + (Math.floor(effect_size * 100) / 100) + "%";
      option.text(text).data("effect_size", effect_size).data("select_lv", skill_lv);
    }

    // アビリティチェック設定
    function setAbilityCheck(input, ability_info, limit_border, limit_count) {
      let disabled = ability_info.ability_type == 1 ? true : false;
      let checked = true;
      switch (ability_info.ability_target) {
        case 1: // 自分
          if (limit_count < limit_border) {
            disabled = true;
            checked = false;
          } else {
            checked = true;
          }
          break;
        case 2: // 前衛
          disabled = false;
          checked = false;
          if (limit_count < limit_border) {
            disabled = true;
          }
          break;
        case 3:	// 常時
        case 4:	// 常時
          if (limit_count < limit_border) {
            disabled = true;
            checked = false;
          } else {
            checked = true;
          }
          break;
      }
      $(input).prop("checked", checked).attr("disabled", disabled);
    }

    // 弱点判定
    function isWaek(skill_info, enemy_info) {
      if (skill_info === undefined) {
        skill_info = getAttackInfo();
      }
      if (enemy_info === undefined) {
        enemy_info = getEnemyInfo();
      }
      if (enemy_info["physical_" + skill_info.attack_physical] > 100) {
        return true;
      }
      if (enemy_info["element_" + skill_info.attack_element] > 100) {
        return true;
      }
      return false;
    }

    // 攻撃リストに追加
    function addAttackList(style, chara_no) {
      let attack_list = $.grep(skill_attack,
          function (obj, index) {
            return (obj.chara_id === style.chara_id && (obj.style_id === style.style_id || obj.style_id == 0));
          });
      let attack_sort_list = attack_list.sort(function (x, y) {
        if (x.style_id < y.style_id) {
          return 1;
        } else {
          return -1;
        }
      })
      $.each(attack_sort_list, function(index2, value) {
        var option = $('<option>')
                    .text(value.attack_name)
                    .val(value.attack_id)
                    .data("chara_no", chara_no)
                    .addClass("chara_id-" + value.chara_id);
        $("#attack_list").append(option);
      });
    }

    // スキルレベルリスト作成
    function createSkillLvList(id, max_lv, select_lv) {
      var selecter = "#" + id;
      $(selecter).html("");
      for (var i = 1; i <= max_lv; i ++) {
        var option = $('<option>')
                      .text(i)
                      .val(i);
        $(selecter).append(option);
      }
      $(selecter).parent().css("display", "block");
      $(selecter + " option[value='" + select_lv + "']").prop('selected', true);
      if (max_lv == 1) {
        $(selecter).prop("disabled", true);
      } else {
        $(selecter).prop("disabled", false);
      }
    }

    // バフリストに追加
    function addBuffList(style, chara_no) {
      // スキル追加
      let buff_list = $.grep(skill_buff,
        function (obj, index) {
          return (obj.chara_id === style.chara_id && (obj.style_id === style.style_id || obj.style_id == 0));
        });
      $.each(buff_list, function(index, value) {
        let effect_size = getEffectSize(value.buff_kind, value.buff_id, chara_no, value.max_lv);
        let buff_element = 0;
        switch (value.buff_kind) {
          case 11: // 属性フィールド
            addElementFiled(style, value.buff_name, value.min_power, value.buff_element);
            return true;
          case 1: // 属性攻撃力アップ
          case 4: // 属性防御力ダウン
          case 8:	// 属性クリティカル率アップ
          case 9:	// 属性クリティカルダメージアップ
            buff_element = value.buff_element;
            break;
          default:
            break;
        }
        let str_buff = buff_kbn[value.buff_kind];
        let display = "none";
        if (buff_element == 0 || (select_attack_skill !== undefined && select_attack_skill.attack_element === buff_element)) {
          display = "block"
        }

        var option = $('<option>')
                    .text(chara_name[style.chara_id] + "：" + value.buff_name + "　" + (Math.floor(effect_size * 100) / 100) + "%")
                    .val(value.buff_id)
                    .data("select_lv", value.max_lv)
                    .data("max_lv", value.max_lv)
                    .data("chara_no", chara_no)
                    .data("effect_size", effect_size)
                    .css("display", display)
                    .addClass("buff_id-" + value.buff_id)
                    .addClass("buff_element-" + buff_element)
                    .addClass("variable_effect_size")
                    .addClass("chara_id-" + value.chara_id);
        $("." + str_buff).append(option);
        if (display == "block") {
          switch (value.buff_kind){
            case 10: // チャージ
            case 11: // 属性フィールド
              sortEffectSize($("#" + str_buff));
              select2ndSkill($("#" + str_buff));
              break;
            default:
              sortEffectSize($("#" + str_buff + "1"));
              sortEffectSize($("#" + str_buff + "2"));
              select2ndSkill($("#" + str_buff + "1"));
              select2ndSkill($("#" + str_buff + "2"));
              break;
          }
        }
      });
    }

    function addElementFiled(style, filed_name, effect_size, filed_element) {
      let display = "none";
      if (filed_element == 0 || (select_attack_skill !== undefined && select_attack_skill.attack_element === filed_element)) {
        display = "block"
      }
      var option = $('<option>')
                  .text(chara_name[style.chara_id] + "：" + filed_name + "　" + effect_size + "%")
                  .data("effect_size", effect_size)
                  .css("display", display)
                  .addClass("buff_element-" + filed_element)
                  .addClass("chara_id-" + style.chara_id);
      $("#element_field").append(option);
      if (display == "block") {
        sortEffectSize($("#element_field"));
        select2ndSkill($("#element_field"));
      }
    }

    // 効果量取得
    function getEffectSize(buff_kind, buff_id, chara_no, skill_lv) {
      let effect_size = 0;
      switch (buff_kind) {
        case 0: // 攻撃力アップ
        case 1: // 属性攻撃力アップ
        case 2: // 心眼
        case 6:	// クリティカル率アップ
        case 7:	// クリティカルダメージアップ
        case 8:	// 属性クリティカル率アップ
        case 9:	// 属性クリティカルダメージアップ
        case 10: // チャージ
          effect_size = getBuffEffectSize(buff_id, chara_no, skill_lv);
          break;
        case 3: // 防御力ダウン
        case 4: // 属性防御力ダウン
        case 5: // 脆弱
        case 19: // DP防御力ダウン
          effect_size = getDebuffEffectSize(buff_id, chara_no, skill_lv);
          break;
        case 16: // 連撃(小)
        case 17: // 連撃(大)
          effect_size = getFunnelEffectSize(buff_id, chara_no, skill_lv);
          break;
        default:
          break;
      }
      return effect_size;
    }

    // スキル設定
    function select2ndSkill(select) {
      select.prop("selectedIndex", 0);
      $(".status_" + select.attr("id")).removeClass("status_" + select.attr("id"));
      for (let i = 1; i < select.find("option").length; i++) {
        let option = select.find("option")[i];
        if ($(option).css("display") != "none") {
          $(option).prop("selected", true);
          let select_lv = $(option).data("select_lv");
          let max_lv = $(option).data("max_lv");
          createSkillLvList(select.attr("id") + "_lv", max_lv, select_lv);
          // 選択スキルのステータスを着色
          setStatusToBuff(option, select.attr("id"));
          return;
        }
      }
      resetSlillLv(select.prop("id"));
    }

    // 選択バフのステータスを着色
    function setStatusToBuff(option, id) {
      let buff = getBuffIdToBuff(Number($(option).val())); 
      if (buff !== undefined) {
        let chara_no = $(option).data("chara_no");
        $("#" + status_kbn[buff.ref_status_1] + "_" + chara_no).addClass("status_" + id);
        $("#" + status_kbn[buff.ref_status_2] + "_" + chara_no).addClass("status_" + id);
      }
    }

    // スキルLv使用不可に戻す
    function resetSlillLv(id) {
      $("#" + id + "_lv").empty();
      $("#" + id + "_lv").parent().css("display", "none");
    }

    // 効果量合計
    function getSumEffectSize(class_name) {
      let effect_size = 0;
      $("." + class_name).each(function(index, value) {
        let selected = $(value).find("option:selected");
        if (selected.val() == "") {
          return true;
        }
        effect_size += Number($(selected).data("effect_size"));
      });
      return effect_size;
    }

    // 合計バフ効果量取得
    function getSumBuffEffectSize() {
      // スキルバフ合計
      let sumBuff = getSumEffectSize("buff");
      // 攻撃力アップアビリティ
      sumBuff += getSumAbilityEffectSize(1);
      // 属性リング(0%-10%)
      if (select_attack_skill.attack_element != 0) {
        sumBuff += Number($("#elememt_ring option:selected").val());
      }
      // ピアス
      let earring = $("#earring option:selected");
      if (Number($("#enemy_destruction").val()) > 100 && earring.data("type") == "attack" ||
          Number($("#enemy_destruction").val()) == 100 && earring.data("type") == "break") {
        let effect_size = Number(earring.data("effect_size"));
        sumBuff += effect_size - (10 / 9 * (select_attack_skill.hit_count - 1));
      }
      // オーバードライブ10%
      if ($("#overdrive").prop("checked")) {
        sumBuff += 10;
      }
      // トークン
      let token_count = Number($("#token_count").val());
      if (select_attack_skill.token_power_up == 1) {
        sumBuff += token_count * 16;
      }
      sumBuff += token_count * getSumAbilityEffectSize(6);
      return 1 + sumBuff / 100;
    }

    // 合計デバフ効果量取得
    function getSumDebuffEffectSize() {
      // スキルデバフ合計
      let sumDebuff = getSumEffectSize("debuff");
      if (Number($("#enemy_destruction").val()) == 100 ) {
        sumDebuff += getSumEffectSize("dp_debuff");;
      } 
      sumDebuff += getSumAbilityEffectSize(7);
      return 1 + sumDebuff / 100;
    }

    // クリティカル率取得
    function getCriticalRate() {
      let chara_no = $("#attack_list option:selected").data("chara_no");
      let critical_rate = 1.5 + (Number($("#" + status_kbn[5] + "_" + chara_no).val()) - Number($("#enemy_stat").val())) * 0.04;
      critical_rate += getSumEffectSize("critical_rate");
      critical_rate += getSumAbilityEffectSize(2);
      return critical_rate > 100 ? 100 : critical_rate;
    }
    
    // クリティカルバフ取得
    function getCriticalBuff() {
      let critical_buff = 50;
      critical_buff += getSumEffectSize("critical_buff");
      critical_buff += getSumAbilityEffectSize(3);
      return 1 + critical_buff / 100;
    }

    // アビリティ効果量合計取得
    function getSumAbilityEffectSize(ability_kind) {
      let ability_effect_size = 0;
      $("input[type=checkbox].ability:checked").each(function(index, value) {
        let ability_id = Number($(value).data("ability_id"));
        let ability_info = getAbilityInfo(ability_id);
        if (ability_info.ability_kind == ability_kind) {
          ability_effect_size += Number($(value).data("effect_size"));
        }
      });
      return ability_effect_size;
    }
  </script>
</head>
<body>
  <header>
    <h1>ヘブバン ダメージ計算機</h1>
  </header>
  <br>
  <div>
    <div class="w-[1080px] mx-auto flex">
        <div>
        <div id="char_list" class="w-[482px] grid grid-cols-7 text-center gap-y-px gap-x-0">
          <div class="mt-5">
            <label>スタイル</label>
            <input type="hidden" id="jewel_type_0" value="">
            <input type="hidden" id="jewel_type_1" value="">
            <input type="hidden" id="jewel_type_2" value="">
            <input type="hidden" id="jewel_type_3" value="">
            <input type="hidden" id="jewel_type_4" value="">
            <input type="hidden" id="jewel_type_5" value="">
          </div>
          <img class="showmodal w-16 h-16" id="chara0" src="img/plus.png" data-chara_no="0">
          <img class="showmodal w-16 h-16" id="chara1" src="img/plus.png" data-chara_no="1">
          <img class="showmodal w-16 h-16" id="chara2" src="img/plus.png" data-chara_no="2">
          <img class="showmodal w-16 h-16" id="chara3" src="img/plus.png" data-chara_no="3">
          <img class="showmodal w-16 h-16" id="chara4" src="img/plus.png" data-chara_no="4">
          <img class="showmodal w-16 h-16" id="chara5" src="img/plus.png" data-chara_no="5">
          <label>限界突破</label>
          <select id="limit_0" class="limit"></select>
          <select id="limit_1" class="limit"></select>
          <select id="limit_2" class="limit"></select>
          <select id="limit_3" class="limit"></select>
          <select id="limit_4" class="limit"></select>
          <select id="limit_5" class="limit"></select>
          <label>力</label>
          <input type="number" id="str_0" class="status" value="400">
          <input type="number" id="str_1" class="status" value="400">
          <input type="number" id="str_2" class="status" value="400">
          <input type="number" id="str_3" class="status" value="400">
          <input type="number" id="str_4" class="status" value="400">
          <input type="number" id="str_5" class="status" value="400">
          <label>器用さ</label>
          <input type="number" id="dex_0" class="status" value="400">
          <input type="number" id="dex_1" class="status" value="400">
          <input type="number" id="dex_2" class="status" value="400">
          <input type="number" id="dex_3" class="status" value="400">
          <input type="number" id="dex_4" class="status" value="400">
          <input type="number" id="dex_5" class="status" value="400">
          <label>体力</label>
          <input type="number" id="con_0" class="status" value="400">
          <input type="number" id="con_1" class="status" value="400">
          <input type="number" id="con_2" class="status" value="400">
          <input type="number" id="con_3" class="status" value="400">
          <input type="number" id="con_4" class="status" value="400">
          <input type="number" id="con_5" class="status" value="400">
          <label>精神</label>
          <input type="number" id="mnd_0" class="status" value="400">
          <input type="number" id="mnd_1" class="status" value="400">
          <input type="number" id="mnd_2" class="status" value="400">
          <input type="number" id="mnd_3" class="status" value="400">
          <input type="number" id="mnd_4" class="status" value="400">
          <input type="number" id="mnd_5" class="status" value="400">
          <label>知力</label>
          <input type="number" id="int_0" class="status effect_size" value="450">
          <input type="number" id="int_1" class="status effect_size" value="450">
          <input type="number" id="int_2" class="status effect_size" value="450">
          <input type="number" id="int_3" class="status effect_size" value="450">
          <input type="number" id="int_4" class="status effect_size" value="450">
          <input type="number" id="int_5" class="status effect_size" value="450">
          <label>運</label>
          <input type="number" id="luk_0" class="status effect_size" value="350">
          <input type="number" id="luk_1" class="status effect_size" value="350">
          <input type="number" id="luk_2" class="status effect_size" value="350">
          <input type="number" id="luk_3" class="status effect_size" value="350">
          <input type="number" id="luk_4" class="status effect_size" value="350">
          <input type="number" id="luk_5" class="status effect_size" value="350">
          <label>宝珠Lv</label>
          <select id="jewel_lv_0" class="jewel"></select>
          <select id="jewel_lv_1" class="jewel"></select>
          <select id="jewel_lv_2" class="jewel"></select>
          <select id="jewel_lv_3" class="jewel"></select>
          <select id="jewel_lv_4" class="jewel"></select>
          <select id="jewel_lv_5" class="jewel"></select>
        </div>
        <br>
        <div class="w-[400px] mx-auto flex">
          攻 撃
          <select id="attack_list" class="w-64">
          </select>
          <div class="lv"><select id="skill_lv"></select></div>
          <img id="attack_physical" class="w-6 h-6" src="img/blank.png">
          <img id="attack_element" class="w-6 h-6" src="img/blank.png">
        </div>
        <br>
        <div class="w-96 mx-auto">
          <div>
            <label>敵選択</label>
            <select id="enemy_class">
              <option value="1">異時層</option>
              <option value="2">オーブボス</option>
            </select>
            <select id="enemy_list">
            </select>
          </div>
          <br>
          <div class="grid grid-cols-4 gap-1">
            <div class="text-right">能力値</div><input type="text" id="enemy_stat" value="" readonly class="w-16 text-right">
            <div class="col-span-2 flex">
              <div class="text-right w-12">DP</div><input type="text" id="enemy_dp" value="" readonly class="w-24 text-right">
            </div>
            <div class="text-right">破壊率上限</div><input type="text" id="enemy_destruction_limit" value="" readonly class="w-16 text-right">
            <div class="col-span-2 flex">
              <div class="text-right w-12">HP</div><input type="text" id="enemy_hp" value="" readonly class="w-24 text-right">
            </div>
            <div class="text-right">破壊率</div><input type="number" id="enemy_destruction" min="100" class="w-28 text-center">
          </div>
          <br>
          <div class="grid grid-cols-9">
            <div class="slash"><input type="image" class="enemy_type_icon" src="img/slash.webp"><input type="text" id="enemy_physical_1" class="enemy_type_value" readonly></div>
            <div class="stab"><input type="image" class="enemy_type_icon" src="img/stab.webp"><input type="text" id="enemy_physical_2" class="enemy_type_value" readonly></div>
            <div class="strike"><input type="image" class="enemy_type_icon" src="img/strike.webp"><input type="text" id="enemy_physical_3" class="enemy_type_value" readonly></div>
            <div class="none"><input type="image" class="enemy_type_icon" src="img/none.webp"><input type="text" id="enemy_element_0" class="enemy_type_value" readonly></div>
            <div class="fire"><input type="image" class="enemy_type_icon" src="img/fire.webp"><input type="text" id="enemy_element_1" class="enemy_type_value" readonly></div>
            <div class="ice"><input type="image" class="enemy_type_icon" src="img/ice.webp"><input type="text" id="enemy_element_2" class="enemy_type_value" readonly></div>
            <div class="thunder"><input type="image" class="enemy_type_icon" src="img/thunder.webp"><input type="text" id="enemy_element_3" class="enemy_type_value" readonly></div>
            <div class="light"><input type="image" class="enemy_type_icon" src="img/light.webp"><input type="text" id="enemy_element_4" class="enemy_type_value" readonly></div>
            <div class="dark"><input type="image" class="enemy_type_icon" src="img/dark.webp"><input type="text" id="enemy_element_5" class="enemy_type_value" readonly></div>
          </div>
        </div>
        <br>
        <div class="w-64 mx-auto text-center">
          <input type="button" id="calc" href="javascript:void(0)" class="calc_btn" value="計 算">
        </div>
        <br>
        <div id="damage_result" class="text-center hidden w-[332px] mx-auto">
          <label class="damage_label">クリティカルダメージ</label><label id="critical_rate" class="damage_label"></label>
          <div class="flex">
            <div>
              <input type="text" id="critical_damage" class="text-center damage" readonly>
            </div>
            <div>
              <div>最大<input type="text" id="critical_damage_max"class="text-center min_damage" readonly></div>
              <div>最小<input type="text" id="critical_damage_min"class="text-center min_damage" readonly></div>
            </div>
          </div>
          <label class="damage_label">通常ダメージ</label>
          <div class="flex">
            <div>
              <input type="text" id="damage" class="text-center damage" readonly>
            </div>
            <div>
              <div>最大<input type="text" id="damage_min" class="text-center min_damage" readonly></div>
              <div>最小<input type="text" id="damage_max"class="text-center min_damage" readonly></div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <div class="w-[605px] text-center">
          <table>
            <colgroup>
              <col width="85px">
              <col width="80px">
              <col width="80px">
              <col width="300px">
              <col width="60px">
            </colgroup>
            <tr>
              <td rowspan="8" class="kind">バフ</td>
              <td class="type" colspan="2">攻撃力アップ1</td>
              <td><select id="power_up1" class="buff power_up include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="power_up1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">攻撃力アップ2</td>
              <td><select id="power_up2" class="buff power_up include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="power_up2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element" colspan="2">属性攻撃力アップ1</td>
              <td class="row_element"><select id="element_up1" class="buff element_up element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="element_up1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element" colspan="2">属性攻撃力アップ2</td>
              <td class="row_element"><select id="element_up2" class="buff element_up element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="element_up2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_weak" colspan="2">心眼1</td>
              <td class="row_weak"><select id="mindeye1" class="mindeye include_lv"><option selected value="">無し</option></select></td>
              <td class="row_weak"><div class="lv"><select id="mindeye1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_weak" colspan="2">心眼2</td>
              <td class="row_weak"><select id="mindeye2" class="mindeye include_lv"><option selected value="">無し</option></select></td>
              <td class="row_weak"><div class="lv"><select id="mindeye2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">連撃1</td>
              <td><select id="funnel1" class="funnel include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="funnel1_lv"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">連撃2</td>
              <td><select id="funnel2" class="funnel include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="funnel2_lv"></select></div></td>
            </tr>            <tr>
              <td rowspan="8" class="kind">デバフ</td>
              <td class="type" colspan="2">防御力ダウン1</td>
              <td><select id="defense_down1" class="debuff defense_down include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="defense_down1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">防御力ダウン2</td>
              <td><select id="defense_down2" class="debuff defense_down include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="defense_down2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">DP防御力ダウン1</td>
              <td><select id="dp_defense_down1" class="dp_debuff dp_defense_down include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="dp_defense_down1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">DP防御力ダウン2</td>
              <td><select id="dp_defense_down2" class="dp_debuff dp_defense_down include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="dp_defense_down2_lv" class="lv_effect"></select></div></td>
            </tr>            
            <tr>
              <td class="type row_element" colspan="2">属性防御力ダウン1</td>
              <td class="row_element"><select id="element_down1" class="debuff element_down element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="element_down1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element" colspan="2">属性防御力ダウン2</td>
              <td class="row_element"><select id="element_down2" class="debuff element_down element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="element_down2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_weak" colspan="2">脆弱1</td>
              <td class="row_weak"><select id="fragile1" class="fragile include_lv"><option selected value="">無し</option></select></td>
              <td class="row_weak"><div class="lv"><select id="fragile1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_weak" colspan="2">脆弱2</td>
              <td class="row_weak"><select id="fragile2" class="fragile include_lv"><option selected value="">無し</option></select></td>
              <td class="row_weak"><div class="lv"><select id="fragile2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td rowspan="8" class="kind">クリティカル</td>
              <td colspan="2">クリティカル率アップ1</td>
              <td><select id="critical_up1" class="critical_rate critical_up include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="critical_up1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">クリティカル率アップ2</td>
              <td><select id="critical_up2" class="critical_rate critical_up include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="critical_up2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">クリダメアップ1</td>
              <td><select id="critical_damege1" class="critical_buff critical_damege include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="critical_damege1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type" colspan="2">クリダメアップ2</td>
              <td><select id="critical_damege2" class="critical_buff critical_damege include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="critical_damege2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element" colspan="2">属性クリ率アップ1</td>
              <td class="row_element"><select id="critical_element1" class="critical_rate critical_element element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="critical_element1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element" colspan="2">属性クリ率アップ2</td>
              <td class="row_element"><select id="critical_element2" class="critical_rate critical_element element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="critical_element2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element" colspan="2">属性クリダメアップ1</td>
              <td class="row_element"><select id="critical_damege_element1" class="critical_buff critical_damege_element element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="critical_damege_element1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element" colspan="2">属性クリダメアップ2</td>
              <td class="row_element"><select id="critical_damege_element2" class="critical_buff critical_damege_element element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="critical_damege_element2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="kind row_element">フィールド</td>
              <td class="type row_element" colspan="2">属性フィールド</td>
              <td class="row_element"><select id="element_field" class="filed element_field element"><option selected value="">無し</option></select></td>
              <td class="row_element" id="filed_lv"></td>
            </tr>
            <tr>
              <td class="kind">チャージ</td>
              <td class="type" colspan="2">チャージ</td>
              <td class=""><select id="charge" class="buff charge"><option selected value="">無し</option></select></td>
              <td class="" id="filed_lv"></td>
            </tr>
            <tr>
              <td rowspan="3" class="kind">アビリティ</td>
              <td>攻撃者</td>
              <td colspan="3" id="ability_self" class="text-left"></td>
            </tr>
            <tr>
              <td>前衛</td>
              <td colspan="3" id="ability_front" class="text-left"></td>
            </tr>
            <tr>
              <td>全体</td>
              <td colspan="3" id="ability_all" class="text-left"></td>
            </tr>
            <tr>
              <td class="kind">その他</td>
              <td colspan="4" >
                <div class="flex pt-1">
                  <div class="w-8"></div>
                  <div>属性リング</div>
                   <select id="elememt_ring" disabled>
                    <option value="0">無し</option>
                    <option value="2">+0(2%)</option>
                    <option value="4">+1(4%)</option>
                    <option value="6">+2(6%)</option>
                    <option value="8">+3(8%)</option>
                    <option value="10">+4(10%)</option>
                  </select>
                  <div class="w-8"></div>
                  <div>ピアス</div>
                  <select id="earring">
                    <option value="0">選択無し</option>
                    <option value="1" data-effect_size="10" data-type="attack">アタック10%</option>
                    <option value="2" data-effect_size="12" data-type="attack">アタック12%</option>
                    <option value="3" data-effect_size="15" data-type="attack">アタック15%</option>
                    <option value="4" data-effect_size="10" data-type="break">ブレイク10%</option>
                    <option value="5" data-effect_size="12" data-type="break">ブレイク12%</option>
                    <option value="6" data-effect_size="15" data-type="break">ブレイク15%</option>
                  </select>
                  <div class="w-8"></div>
                  <div>トークン数</div>
                  <select id="token_count" class="token">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </div>
                <div class="flex pt-1 pb-1">
                  <div class="w-8"></div>
                  <input type="checkbox" id="overdrive" class=""><label class="checkbox01" for="overdrive">オーバードライブ</label>
                  <div class="w-8"></div>
                  <input type="checkbox" id="fightingspirit" class=""><label class="checkbox01" for="fightingspirit">闘志</label>
                  <div class="w-8"></div>
                  <input type="checkbox" id="misfortune" class=""><label class="checkbox01" for="misfortune">厄</label>
                </div>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="modal_layer">
    <div class="modal_layer_mask"></div>
    <div class="modal_layer_inner">
      <div class="modal_section">
        <div class="modal">
          <div class="modal_inner">
            <div class="modal_inner_headline">
              <div class="flex justify-center leading-10">
                <div>スタイル選択</div>
                <input type="button" id="calc" href="javascript:void(0)" class="remove_btn text-center absolute right-1" value="外す">
              </div>
            </div>
            <hr class="line"/>
            <div class="flex">
              <div class="w-8"></div>
              <input type="image" class="narrow physical" id="physical_1" src="img/slash.webp" data-select="1">
              <input type="image" class="narrow physical" id="physical_2" src="img/stab.webp" data-select="1">
              <input type="image" class="narrow physical" id="physical_3" src="img/strike.webp" data-select="1">
              <div class="w-16"></div>
              <input type="image" class="narrow element" id="element_0" src="img/none.webp" data-select="1">
              <input type="image" class="narrow element" id="element_1" src="img/fire.webp" data-select="1">
              <input type="image" class="narrow element" id="element_2" src="img/ice.webp" data-select="1">
              <input type="image" class="narrow element" id="element_3" src="img/thunder.webp" data-select="1">
              <input type="image" class="narrow element" id="element_4" src="img/light.webp" data-select="1">
              <input type="image" class="narrow element" id="element_5" src="img/dark.webp" data-select="1">
            </div>
            <div class="flex">
              <input type="button" class="narrow role" id="role_1" value="ATTACKER" data-select="1">
              <input type="button" class="narrow role" id="role_2" value="BREAKER" data-select="1">
              <input type="button" class="narrow role" id="role_3" value="BLASTER" data-select="1">
              <input type="button" class="narrow role" id="role_4" value="HEALER" data-select="1">
              <input type="button" class="narrow role" id="role_5" value="BUFFER" data-select="1">
              <input type="button" class="narrow role" id="role_6" value="DEBUFFER" data-select="1">
              <input type="button" class="narrow role" id="role_7" value="DEFENDER" data-select="1">
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31a.webp">
              <div id="sytle_list_31A" class="grid grid-cols-8 troops_31A"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31b.webp">
              <div id="sytle_list_31B" class="grid grid-cols-8 troops_31B"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31c.webp">
              <div id="sytle_list_31C" class="grid grid-cols-8 troops_31C"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31d.webp">
              <div id="sytle_list_31D" class="grid grid-cols-8 troops_31D"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31e.webp">
              <div id="sytle_list_31E" class="grid grid-cols-8 troops_31E"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31f.webp">
              <div id="sytle_list_31F" class="grid grid-cols-8 troops_31F"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31x.webp">
              <div id="sytle_list_31X" class="grid grid-cols-8 troops_31X"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/30g.webp">
              <div id="sytle_list_30G" class="grid grid-cols-8 troops_30G"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/angelbeats.webp">
              <div id="sytle_list_AB" class="grid grid-cols-8  troops_AB"></div>
            </div>
          </div>
          <br>
        </div>
      </div>
    </div>
  </div>
  <footer>
  </footer>
</body>
</html>
