<!DOCTYPE html>
<html>
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-E24414GK3M"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-E24414GK3M');
  </script>
  <meta charset="unicode">
  <meta content="ヘブンバーンズレッドのSSスタイル所持率チェッカーです。" name="description">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@RELI_hevburn" />
  <meta name="twitter:title" content="ヘブバン スタイル所持率チェッカー" />
  <meta name="twitter:description" content="ヘブンバーンズレッドのSSスタイル所持率チェッカーです。" />
  <meta name="twitter:image" content="https://hbr-tool.github.io/damage-calculator/img/summary_checker.png" />
  <title>ヘブバン スタイル所持率チェッカー</title>
  <link rel="stylesheet" href="css/checker.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="js/header.js"></script>
  <script src="js/chara_style.js"></script>
  <script src="js/chara_name.js"></script>
  <script src="js/checker.js"></script>
  <script>
    let select_count = 0;
    $(function(){ 
      style_list = style_list.filter(function(style) {
        return style.chara_id != 51;
      });
      // キャラID/実装順
      style_list.sort(compare);
      setHeaderLink();
      createStyleList();
      setEventTrigger();

      
    // 画像ファイル名一覧
    var imageSources = ['select/ADateDefault_R3_Select.webp', 'select/AKanzakiAgent_R3_Select.webp', 
            'select/EAoiWaitress_R3_Select.webp', 'select/KHiiragiBloody_R3_Select.webp', 
            'select/MSatsukiBride_R3_Select.webp', 'select/MTenneAnimal_R3_Select.webp', 
            'select/SHanamuraDefault_R3_Select.webp', 'select/TTojoSuite_R3_Select.webp',
            'select/ADateDefault_R3_Select.webp', 'select/AKanzakiAgent_R3_Select.webp', 
            'select/EAoiWaitress_R3_Select.webp', 'select/KHiiragiBloody_R3_Select.webp', 
            'select/MSatsukiBride_R3_Select.webp', 'select/MTenneAnimal_R3_Select.webp', 
            'select/SHanamuraDefault_R3_Select.webp', 'select/TTojoSuite_R3_Select.webp'];

      // 関数呼び出し
      combineImagesWithHatching(imageSources);

    });




    
    function drawHatching(layer, x, y, width, height, hatchSize, hatchAngle) {
    var numHatchLines = Math.ceil(Math.sqrt(width * width + height * height) / hatchSize);

    for (var i = 0; i < numHatchLines; i++) {
        var line = new Konva.Line({
            points: [i * hatchSize, 0, i * hatchSize - height, height],
            stroke: 'black',
            strokeWidth: 1,
            x: x,
            y: y,
            rotation: hatchAngle * (180 / Math.PI),
        });

        layer.add(line);
    }
}

function combineImagesWithHatching(imageSources) {
    var stage = new Konva.Stage({
        container: 'container',
        width: 400, // 仮の幅
        height: 200, // 仮の高さ
    });

    var layer = new Konva.Layer();

    var hatchSize = 5; // 網掛けのサイズ
    var hatchAngle = Math.PI / 4; // 45度

    var images = [];
    var loadedImages = 0;

    imageSources.forEach(function (src, index) {
        var img = new Image();
        img.onload = function () {
            loadedImages++;

            // 画像サイズを半分に
            var resizedWidth = img.width / 2;
            var resizedHeight = img.height / 2;

            // 画像をCanvasに描画
            var row = Math.floor(index / 4);
            var col = index % 4;

            var image = new Konva.Image({
                image: img,
                x: col * resizedWidth,
                y: row * resizedHeight,
                width: resizedWidth,
                height: resizedHeight,
            });

            layer.add(image);

            // 網掛けを描画
            drawHatching(layer, col * resizedWidth, row * resizedHeight, resizedWidth, resizedHeight, hatchSize, hatchAngle);

            if (loadedImages === imageSources.length) {
                // Canvasサイズを設定
                stage.width(layer.width());
                stage.height(layer.height());

                // 画像を描画したLayerをStageに追加
                stage.add(layer);
            }
        };
        img.src = src;
        images.push(img);
    });
}

  </script>
</head>
<body>
  <header>
    <h1>ヘブバン スタイル所持率チェッカー</h1>
    <div class="header_link">
      <input id="damage-calculator" type="button" value="ダメージ計算ツール">
      <input id="style-checker" type="button" value="スタイル所持率チェッカー">
    </div>
  </header>
  <main>
    <div class="frame static w-screen h-screen overflow-y-scroll">
      <div class="main_area mx-auto">
        <div class="text-right">
          <input type="button" id="btn_select" class="w-20 mt-2 mb-2 default" value="全選択">
          <input type="button" id="btn_release" class="w-20 mt-2 mb-2 default" value="全解除">  
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/31a.webp">
          <div id="sytle_list_31A" class="grid grid-cols-8 troops_31A"></div>
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/31b.webp">
          <div id="sytle_list_31B" class="grid grid-cols-8 troops_31B"></div>
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/31c.webp">
          <div id="sytle_list_31C" class="grid grid-cols-8 troops_31C"></div>
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/31d.webp">
          <div id="sytle_list_31D" class="grid grid-cols-8 troops_31D"></div>
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/31e.webp">
          <div id="sytle_list_31E" class="grid grid-cols-8 troops_31E"></div>
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/31f.webp">
          <div id="sytle_list_31F" class="grid grid-cols-8 troops_31F"></div>
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/31x.webp">
          <div id="sytle_list_31X" class="grid grid-cols-8 troops_31X"></div>
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/30g.webp">
          <div id="sytle_list_30G" class="grid grid-cols-8 troops_30G"></div>
        </div>
        <div class="troops">
          <input type="image" class="emblem" src="img/angelbeats.webp">
          <div id="sytle_list_AB" class="grid grid-cols-8  troops_AB"></div>
        </div>
      </div>
    </div>
    <canvas id="combinedCanvas"></canvas>
  </main>
  <footer>
    <div class="w-[300px] mx-auto text-center">
      <div class="flex text-2xl font-bold">
        <div class="w-48">所持数</div>
        <div class="flex">
          <label id="style_select" class="text-red-700 text-3xl"></label><div calss="text-3xl">/</div><label id="style_all" class="mt-1"></label>
        </div>
      </div>
      <div class="flex text-2xl font-bold">
        <div class="w-48">コンプリート率</div>
        <label id="rate_complate" class="text-center w-24"></label>
      </div>
      <input type="button" class="btn_post mt-2 mb-2 default" value="結果を𝕏にPOST">
    </div>
  </footer>
</body>
</html>
