<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ヘブバン ダメージ計算機</title>
  <link rel="stylesheet" href="css/modal.css">
  <link rel="stylesheet" href="css/damege.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="js/chara_name.js"></script>
  <script src="js/chara_style.js"></script>
  <script src="js/damege.js"></script>
  <script src="js/skill_attack.js"></script>
  <script src="js/skill_buff.js"></script>
  <script src="js/enemy.js"></script>
  <script>

    var chara_no;
    var select_style_list = [0, 0, 0, 0, 0, 0];
    var status_kbn = ["", "str", "dex", "con", "mnd", "int", "luk"];
    var type_physical = ["", "slash", "stab", "strike"];
    var type_element = ["none", "fire", "ice", "thunder", "light", "dark"];
    var select_attack_skill;

    $(function(){ 
      // スタイルリスト作成
      $.each(style_list, function(index, value) {
        let source = "icon/" + value.image_url;
        var input = $('<input>')
                    .attr("type", "image")
                    .attr("src", source)
                    .data("style_id", value.style_id)
                    .addClass("select_style")
                    .addClass("physical_" + value.physical)
                    .addClass("element_" + value.element)
                    .addClass("role_" + value.role);
        $("#sytle_list_" + value.troops).append(input);
      });

      $("input[type='number']").prop("step", 1);
      $(".status").prop("max", 999);
      $(".status").prop("min", 1);
      $(".jewel").prop("max", 5);
      $(".jewel").prop("min", 0);

      createEnemyList("1");
      $("#enemy_class").on("change", function(event) {
        let enemy_class = $("#enemy_class option:selected").val();
        createEnemyList(enemy_class);
      })
      $("#enemy_list").on("change", function(event) {
        setEnemyStatus();
        if (isWaek(undefined, undefined)) {
          $(".row_weak").css("display", "table-cell");      
        } else {
          $(".row_weak").css("display", "none");      
        }
      });

      // 計算
      $("#calc").on("click", function(event) {
        // 闘志
        let fightingspirit = $("#fightingspirit").prop("checked") ? -20 : 0;
        // 厄
        let misfortune = $("#misfortune").prop("checked") ? -20 : 0;

        let skill_info = getAttackInfo();
        let basePower = getBasePower(fightingspirit + misfortune);
        let buff = getBuff();
        let debuff = getDebuff();
        // let funnel = getFunnel();
        let ability = 1;
        let element_field = 1;
        if (skill_info.attack_element != 0 && $("#element_field option:selected").val() != "") {
          element_field += Number($("#element_field option:selected").data("effect_size")) / 100;
        }
        let weak_physical = $("#enemy_physical_" + skill_info.attack_physical).val() / 100;
        let weak_element = $("#enemy_element_" + skill_info.attack_element).val() / 100;
        let special = 1;
        let destruction_rate = Number($("#enemy_destruction").val()) / 100;
        if (destruction_rate == 1) {
          special += skill_info.dp_damege / 100;
        } else {
          special += skill_info.hp_damege / 100;
        }
        let damage = basePower * buff * debuff * ability * element_field * weak_physical * weak_element * special * destruction_rate;

        let criticalPower = getBasePower(fightingspirit - 50);
        let criticalBuff = getCriticalBuff();
        let criticalRate = getCriticalRate();
        let critical_damage = criticalPower * buff * debuff *  ability * element_field * weak_physical * weak_element * special * destruction_rate * criticalBuff;
        $("#damage").val(Math.floor(damage).toLocaleString());
        $("#damage_min").val(Math.floor(damage * 0.9).toLocaleString());
        $("#damage_max").val(Math.floor(damage * 1.1).toLocaleString());
        $("#critical_damage").val(Math.floor(critical_damage).toLocaleString());
        $("#critical_damage_min").val(Math.floor(critical_damage * 0.9).toLocaleString());
        $("#critical_damage_max").val(Math.floor(critical_damage * 1.1).toLocaleString());
        $("#critical_rate").text("(発生率:" + criticalRate + "%)");
        $("#damage_result").show();
      });
      
      // 攻撃スキル変更
      $("#attack_list").on("change", function(event) {
        if (select_attack_skill !== undefined) {
          if (select_attack_skill.attack_element !== 0) {
            $(".buff_element-" + select_attack_skill.attack_element).hide();
          }
          $("." + type_physical[select_attack_skill.attack_physical]).removeClass("selected");
          $("." + type_element[select_attack_skill.attack_element]).removeClass("selected");
        }
        if ($("#attack_list option").length == 0)  {
          $("#attack_physical").attr("src", "img/blank.png");
          $("#attack_element").attr("src", "img/blank.png");
          // 選択無しの場合は、削除のみ
          return;
        }
        let skill_info = getAttackInfo();
        let max_lv = skill_info.max_lv;
        $(".buff_element-" + skill_info.attack_element).show();
        $(".element").each(function(index, value) {
          select2ndSkill($(value));
        });
        let attack_physical = type_physical[skill_info.attack_physical];
        let attack_element = type_element[skill_info.attack_element];
        $("#attack_physical").attr("src", "img/" + attack_physical + ".webp");
        $("#attack_element").attr("src", "img/" + attack_element + ".webp");
        $("." + attack_physical).addClass("selected");
        $("." + attack_element).addClass("selected");
        
        if (skill_info.attack_element == 0) {
          $(".row_element").css("display", "none");      
        } else {
          $(".row_element").css("display", "table-cell");      
        }
        if (isWaek(skill_info, undefined)) {
          $(".row_weak").css("display", "table-cell");      
        } else {
          $(".row_weak").css("display", "none");      
        }
        select_attack_skill = skill_info;

        createSkillLvList("skill_lv", max_lv, max_lv);
      });
      // バフスキル変更
      $(".include_lv").on("change", function(event) {
        let index = $(this).prop("selectedIndex");
        if (index == 0) {
          $("#" + $(this).prop("id") + "_lv").parent().css("display", "none");
        } else {
          let option = $(this).children().eq(index);
          let select_lv = option.data("select_lv");
          let skill_info = getBuffIdToBuff(Number(option.val()));
          createSkillLvList($(this).prop("id") + "_lv", skill_info.max_lv, select_lv);
        }
      });
      // スキルレベル変更
      $(".lv_effect").on("change", function(event) {
        let buff_type_id = $(this).attr("id").replace("_lv", "");
        let skill_lv = $(this).prop("selectedIndex") + 1;
        // バフ取得
        let option = $("#" + buff_type_id + " option:selected");
        let buff_id = Number(option.val());
        let chara_no = option.data("chara_no");
        let skill_buff = getBuffIdToBuff(buff_id);
        let effect_size = getEffectSize(skill_buff.buff_kind, buff_id, chara_no, skill_lv);
        let chara_id = select_style_list[chara_no].chara_id;
        let text = chara_name[chara_id] + "：" + skill_buff.buff_name + "　" + effect_size + "%";
        // 同一スキル別セレクトボックス含めて反映
        let option2 = $(".chara_id-" + chara_id + ".buff_id-" + buff_id);
        option2.text(text).data("effect_size", effect_size).data("select_lv", skill_lv);
        $.each(option2, function(index, value) {
          if ($(value).prop("selected")) {
            $("#" + $(value).parent().attr("id") +"_lv").prop("selectedIndex", skill_lv - 1);
          }
        });
      });

      // ステータス変更

      // モーダルを開く
      $('.showmodal').on('click', function(){
        chara_no = $(this).data("chara_no");
        $('.modal_layer').addClass('isShow');
      });

      let narrow = {"physical": "", "element": "", "role": "" };
      // スタイル絞り込み
      $(".narrow").on('click', function() {
        let classification = "";
        if ($(this).hasClass("physical")) {
          classification = "physical";
        } else if ($(this).hasClass("element")) {
          classification = "element";
        } else {
          classification += "role";
        }
        let selecter = ".narrow" + "." + classification;
        if ($(this).data("select") == "1") {
          $(selecter).css("opacity", "0.3");
          $(selecter).data("select", "1");
          $(this).css("opacity", "1");
          $(this).data("select", "0");
          narrow[classification] = "." + $(this).prop("id");
        } else {
          $(selecter).css("opacity", "1");
          $(selecter).data("select", "1");
          narrow[classification] = "";
        }

        $(".select_style").hide();
        let show_class = ".select_style" + narrow.physical + narrow.element + narrow.role;
        $(show_class).show();
      })

      // スタイルを選択
      $('.select_style').on('click', function(){
        let style_id = $(this).data("style_id");
        let style = $.grep(style_list,
          function (obj, index) {
            return (obj.style_id === style_id);
          })[0];
        // 同一のキャラIDは不許可
        for(let idx in select_style_list) {
          if (select_style_list[idx].chara_id === style.chara_id && chara_no != idx) {
            alert("同一キャラクターは複数選択できません");
            return false;
          }
        }
        // メンバーの情報を削除
        removeMember();
        
        // 画像切り替え
        select_style_list[chara_no] = style;
        $('[data-chara_no="' + chara_no + '"]').attr("src", "icon/" + style.image_url);

        // 宝珠スキルタイプを設定
        $("#jewel_type_" + chara_no).val(style.jewel_type);
        addAttackList(style, chara_no);
        $("#attack_list").trigger("change");
        addBuffList(style, chara_no);
        closeModel();
      });
      // メンバーを外す
      $('.remove_btn').on('click', function(){
        removeMember();
        closeModel();
      });

      $('.modal_layer_mask').on('click', function(){
        closeModel();
      });
    });

    // 弱点判定
    function isWaek(skill_info, enemy_info) {
      if (skill_info === undefined) {
        skill_info = getAttackInfo();
      }
      if (enemy_info === undefined) {
        enemy_info = getEnemyInfo();
      }
      if (enemy_info["physical_" + skill_info.attack_physical] > 100) {
        return true;
      }
      if (enemy_info["element_" + skill_info.attack_element] > 100) {
        return true;
      }
      return false;
    }

    function updateStatusList(chara_no) {

    }
    // モーダルを閉じる
    function closeModel() {
      chara_no = 0;
      $('.modal_layer').removeClass('isShow');
    }

    // メンバーを外す
    function removeMember() {
      // 入れ替えスタイルのスキルを削除
      let chara_id_class = ".chara_id-" + select_style_list[chara_no].chara_id;
      let parent = $(".include_lv " + chara_id_class + ":selected").parent();
      $.each(parent, function(index, value) {
        // 暫定的にdisplay:none追加
        $(value).find(chara_id_class).css("display", "none");
        select2ndSkill($("#" + $(value).prop("id")));
      });
      // 該当メンバーのスキル削除
      $(chara_id_class).remove();
      select_style_list[chara_no] = 0;
      // 画像初期化
      $('[data-chara_no="' + chara_no + '"]').attr("src", "img/plus.png");
      // スキル情報編集
      $("#attack_list").trigger("change");
    }

    // 攻撃リストに追加
    function addAttackList(style, chara_no) {
      let attack_list = $.grep(skill_attack,
          function (obj, index) {
            return (obj.chara_id === style.chara_id && (obj.style_id === style.style_id || obj.style_id == 0));
          });
      let attack_sort_list = attack_list.sort(function (x, y) {
        if (x.style_id < y.style_id) {
          return 1;
        } else {
          return -1;
        }
      })
      $.each(attack_sort_list, function(index2, value) {
        var option = $('<option>')
                    .text(value.attack_name)
                    .val(value.attack_id)
                    .data("chara_no", chara_no)
                    .addClass("chara_id-" + value.chara_id);
        $("#attack_list").append(option);
      });
    }

    // スキルレベルリスト作成
    function createSkillLvList(id, max_lv, select_lv) {
      var selecter = "#" + id;
      $(selecter).html("");
      for (var i = 1; i <= max_lv; i ++) {
        var option = $('<option>')
                      .text(i)
                      .val(i);
        $(selecter).append(option);
      }
      $(selecter).parent().css("display", "block");
      $(selecter + " option[value='" + select_lv + "']").prop('selected', true);
      if (max_lv == 1) {
        $(selecter).prop("disabled", true);
      } else {
        $(selecter).prop("disabled", false);
      }
    }

    // バフリストに追加
    function addBuffList(style, chara_no) {
      // スキル追加
      let buff_list = $.grep(skill_buff,
        function (obj, index) {
          return (obj.chara_id === style.chara_id && (obj.style_id === style.style_id || obj.style_id == 0));
        });
      $.each(buff_list, function(index, value) {
        let effect_size = getEffectSize(value.buff_kind, value.buff_id, chara_no, value.max_lv);
        let buff_element = 0;
        switch (value.buff_kind) {
          case 11: // 属性フィールド
            effect_size = value.min_power;
          case 1: // 属性攻撃力アップ
          case 8:	// 属性クリティカル率アップ
          case 9:	// 属性クリティカルダメージアップ
          case 4: // 属性防御力ダウン
            buff_element = value.buff_element;
            break;
          default:
            break;
        }
        let str_buff = buff_kbn[value.buff_kind];
        let display = "none";
        if (buff_element == 0 || (select_attack_skill !== undefined && select_attack_skill.attack_element === buff_element)) {
          display = "block"
        }

        var option = $('<option>')
                    .text(chara_name[style.chara_id] + "：" + value.buff_name + "　" + effect_size + "%")
                    .val(value.buff_id)
                    .data("select_lv", value.max_lv)
                    .data("max_lv", value.max_lv)
                    .data("chara_no", chara_no)
                    .data("effect_size", effect_size)
                    .css("display", display)
                    .addClass("buff_id-" + value.buff_id)
                    .addClass("buff_element-" + buff_element)
                    .addClass("chara_id-" + value.chara_id);
        $("." + str_buff).append(option);
        if (display == "block") {
          switch (value.buff_kind){
            case 10: // チャージ
            case 11: // 属性フィールド
              sortEffectSize($("#" + str_buff));
              select2ndSkill($("#" + str_buff));
              break;
            default:
              sortEffectSize($("#" + str_buff + "1"));
              sortEffectSize($("#" + str_buff + "2"));
              select2ndSkill($("#" + str_buff + "1"));
              select2ndSkill($("#" + str_buff + "2"));
              break;
          }
        }

      });
    }

    function getEffectSize(buff_kind, buff_id, chara_no, skill_lv) {
      let effect_size = 0;
      switch (buff_kind) {
          case 1: // 属性攻撃力アップ
          case 8:	// 属性クリティカル率アップ
          case 9:	// 属性クリティカルダメージアップ
          case 0: // 攻撃力アップ
          case 2: // 心眼
          case 6:	// クリティカル率アップ
          case 7:	// クリティカルダメージアップ
          case 10: // チャージ
            effect_size = Math.floor(getBuffEffectSize(buff_id, chara_no, skill_lv) * 100) / 100;
            break;
          case 4: // 属性防御力ダウン
          case 3: // 防御力ダウン
          case 5: // 脆弱
          case 19: // DP防御力ダウン
            effect_size = Math.floor(getDebuffEffectSize(buff_id, chara_no, skill_lv) * 100) / 100;
            break;
          case 16: // 連撃(小)
          case 17: // 連撃(大)
            effect_size = Math.floor(getFunnelEffectSize(buff_id, chara_no, skill_lv) * 100) / 100;
            break;
          default:
            break;
        }
        return effect_size;
    }

    // スキル設定
    function select2ndSkill(select) {
      select.prop("selectedIndex", 0);
      for (let i = 1; i < select.find("option").length; i++) {
        let option = select.find("option")[i];
        if ($(option).css("display") != "none") {
          $(option).prop("selected", true);
          let select_lv = $(option).data("select_lv");
          let max_lv = $(option).data("max_lv");
          createSkillLvList(select.attr("id") + "_lv", max_lv, select_lv);
          return;
        }
      }
      resetSlillLv(select.prop("id"));
    }

    // スキルLv使用不可に戻す
    function resetSlillLv(id) {
      $("#" + id + "_lv").empty();
      $("#" + id + "_lv").prop("disabled", true);
    }

    // バフ合計取得
    function getBuff() {
      let multiplier = 1;
      let power_up = 0;
      let element_up = 0;
      let mindeye = 0;
      let funnel = 0;
      $(".buff").each(function(index, value) {
        let selected = $(value).find("option:selected");
        if (selected.val() == "") {
          return true;
        }
        let buff_id = Number(selected.val());
        let skill_lv = Number(selected.data("select_lv"));
        let chara_no = selected.data("chara_no");
        if ($(value).hasClass("funnel")) {
          effect_size = getFunnelEffectSize(buff_id, chara_no, skill_lv);
        } else {
          effect_size = getBuffEffectSize(buff_id, chara_no, skill_lv);
        }

        // バフ分類
        if ($(value).hasClass("power_up")) {
          power_up += effect_size;
        } else if ($(value).hasClass("element_up")) {
          element_up += effect_size;
        } else if ($(value).hasClass("mindeye")) {
          mindeye += effect_size;
        } else if ($(value).hasClass("charge")) {
          power_up += effect_size;
        } else if ($(value).hasClass("funnel")) {
          funnel += effect_size;
        }
      });
      if (!isWaek()) {
        fragile = 0;
      }
      multiplier *= (1 + (power_up + element_up) / 100) * (1 + mindeye / 100) * (1 + funnel / 100);
      return multiplier;
    }

    // デバフ合計取得
    function getDebuff() {
      let multiplier = 1;
      let defense_down = 0;
      let element_down = 0;
      let fragile = 0;
      $(".debuff").each(function(index, value) {
        let selected = $(value).find("option:selected");
        if (selected.val() == "") {
          return true;
        }
        let buff_id = Number(selected.val());
        let skill_lv = Number(selected.data("select_lv"));
        let chara_no = selected.data("chara_no");
       effect_size = getDebuffEffectSize(buff_id, chara_no, skill_lv);
        // バフ分類
        if ($(value).hasClass("defense_down")) {
          defense_down += effect_size;
        } else if ($(value).hasClass("element_down")) {
          element_down += effect_size;
        } else if ($(value).hasClass("fragile")) {
          fragile += effect_size;
        }
      });
      if (!isWaek()) {
        fragile = 0;
      }
      multiplier *= (1 + (defense_down + element_down) / 100) * (1 + fragile / 100);
      return multiplier;
    }

    function getCriticalRate() {
      let chara_no = $("#attack_list option:selected").data("chara_no");

      let critical_rate = 1.5 + Number($("#enemy_stat").val()) + Number($("#" + status_kbn[5] + "_" + chara_no).val()) * 0.04;

      $(".critical_rate").each(function(index, value) {
        let selected = $(value).find("option:selected");
        if (selected.val() == "") {
          return true;
        }
        critical_rate += Number(selected.data("effect_size"));
      });
      return critical_rate > 100 ? 100 : critical_rate;
    }

    function getCriticalBuff() {
      let criticalBuff = 150;
      $(".critical_buff").each(function(index, value) {
        let selected = $(value).find("option:selected");
        if (selected.val() == "") {
          return true;
        }
        criticalBuff += Number(selected.data("effect_size"));
      });
      return criticalBuff / 100;
    }

  </script>
</head>
<body>
  <header>
    <h1>ヘブバン ダメージ計算機</h1>
  </header>
  <br>
  <div>
    <div class="w-[1080px] mx-auto flex">
        <div>
        <div id="char_list" class="w-[482px] grid grid-cols-7 text-center gap-y-px gap-x-0">
          <div class="mt-5">
            <label>スタイル</label>
            <input type="hidden" id="jewel_type_0" value="">
            <input type="hidden" id="jewel_type_1" value="">
            <input type="hidden" id="jewel_type_2" value="">
            <input type="hidden" id="jewel_type_3" value="">
            <input type="hidden" id="jewel_type_4" value="">
            <input type="hidden" id="jewel_type_5" value="">
          </div>
          <img class="showmodal w-16 h-16" id="chara0" src="img/plus.png" data-chara_no="0">
          <img class="showmodal w-16 h-16" id="chara1" src="img/plus.png" data-chara_no="1">
          <img class="showmodal w-16 h-16" id="chara2" src="img/plus.png" data-chara_no="2">
          <img class="showmodal w-16 h-16" id="chara3" src="img/plus.png" data-chara_no="3">
          <img class="showmodal w-16 h-16" id="chara4" src="img/plus.png" data-chara_no="4">
          <img class="showmodal w-16 h-16" id="chara5" src="img/plus.png" data-chara_no="5">
          <label>限界突破</label>
          <input type="number" id="limit_0" class="status" value="2">
          <input type="number" id="limit_1" class="status" value="2">
          <input type="number" id="limit_2" class="status" value="2">
          <input type="number" id="limit_3" class="status" value="2">
          <input type="number" id="limit_4" class="status" value="2">
          <input type="number" id="limit_5" class="status" value="2">
          <label>力</label>
          <input type="number" id="str_0" class="status" value="400">
          <input type="number" id="str_1" class="status" value="400">
          <input type="number" id="str_2" class="status" value="400">
          <input type="number" id="str_3" class="status" value="400">
          <input type="number" id="str_4" class="status" value="400">
          <input type="number" id="str_5" class="status" value="400">
          <label>器用さ</label>
          <input type="number" id="dex_0" class="status" value="400">
          <input type="number" id="dex_1" class="status" value="400">
          <input type="number" id="dex_2" class="status" value="400">
          <input type="number" id="dex_3" class="status" value="400">
          <input type="number" id="dex_4" class="status" value="400">
          <input type="number" id="dex_5" class="status" value="400">
          <label>体力</label>
          <input type="number" id="con_0" class="status" value="400">
          <input type="number" id="con_1" class="status" value="400">
          <input type="number" id="con_2" class="status" value="400">
          <input type="number" id="con_3" class="status" value="400">
          <input type="number" id="con_4" class="status" value="400">
          <input type="number" id="con_5" class="status" value="400">
          <label>精神</label>
          <input type="number" id="mnd_0" class="status" value="400">
          <input type="number" id="mnd_1" class="status" value="400">
          <input type="number" id="mnd_2" class="status" value="400">
          <input type="number" id="mnd_3" class="status" value="400">
          <input type="number" id="mnd_4" class="status" value="400">
          <input type="number" id="mnd_5" class="status" value="400">
          <label>知力</label>
          <input type="number" id="int_0" class="status" value="450">
          <input type="number" id="int_1" class="status" value="450">
          <input type="number" id="int_2" class="status" value="450">
          <input type="number" id="int_3" class="status" value="450">
          <input type="number" id="int_4" class="status" value="450">
          <input type="number" id="int_5" class="status" value="450">
          <label>運</label>
          <input type="number" id="luk_0" class="status" value="350">
          <input type="number" id="luk_1" class="status" value="350">
          <input type="number" id="luk_2" class="status" value="350">
          <input type="number" id="luk_3" class="status" value="350">
          <input type="number" id="luk_4" class="status" value="350">
          <input type="number" id="luk_5" class="status" value="350">
          <label>宝珠Lv</label>
          <input type="number" id="jewel_lv_0" class="jewel" value="5">
          <input type="number" id="jewel_lv_1" class="jewel" value="5">
          <input type="number" id="jewel_lv_2" class="jewel" value="5">
          <input type="number" id="jewel_lv_3" class="jewel" value="5">
          <input type="number" id="jewel_lv_4" class="jewel" value="5">
          <input type="number" id="jewel_lv_5" class="jewel" value="5">
        </div>
        <br>
        <div class="w-[400px] mx-auto flex">
          攻 撃
          <select id="attack_list" class="w-64">
          </select>
          <div class="lv"><select id="skill_lv"></select></div>
          <img id="attack_physical" class="w-6 h-6" src="img/blank.png">
          <img id="attack_element" class="w-6 h-6" src="img/blank.png">
        </div>
        <br>
        <div class="w-96 mx-auto">
          <div>
            <label>敵選択</label>
            <select id="enemy_class">
              <option value="1">異時層</option>
              <option value="2">オーブボス</option>
            </select>
            <select id="enemy_list">
            </select>
          </div>
          <br>
          <div class="grid grid-cols-4 gap-1">
            <div class="text-right">能力値</div><input type="text" id="enemy_stat" value="" readonly class="w-16 text-right">
            <div class="col-span-2 flex">
              <div class="text-right w-12">DP</div><input type="text" id="enemy_dp" value="" readonly class="w-24 text-right">
            </div>
            <div class="text-right">破壊率上限</div><input type="text" id="enemy_destruction_limit" value="" readonly class="w-16 text-right">
            <div class="col-span-2 flex">
              <div class="text-right w-12">HP</div><input type="text" id="enemy_hp" value="" readonly class="w-24 text-right">
            </div>
            <div class="text-right">破壊率</div><input type="number" id="enemy_destruction" value="" class="w-28 text-center">
          </div>
          <br>
          <div class="grid grid-cols-9">
            <div class="slash"><input type="image" class="enemy_type_icon" src="img/slash.webp"><input type="text" id="enemy_physical_1" class="enemy_type_value" readonly></div>
            <div class="stab"><input type="image" class="enemy_type_icon" src="img/stab.webp"><input type="text" id="enemy_physical_2" class="enemy_type_value" readonly></div>
            <div class="strike"><input type="image" class="enemy_type_icon" src="img/strike.webp"><input type="text" id="enemy_physical_3" class="enemy_type_value" readonly></div>
            <div class="none"><input type="image" class="enemy_type_icon" src="img/none.webp"><input type="text" id="enemy_element_0" class="enemy_type_value" readonly></div>
            <div class="fire"><input type="image" class="enemy_type_icon" src="img/fire.webp"><input type="text" id="enemy_element_1" class="enemy_type_value" readonly></div>
            <div class="ice"><input type="image" class="enemy_type_icon" src="img/ice.webp"><input type="text" id="enemy_element_2" class="enemy_type_value" readonly></div>
            <div class="thunder"><input type="image" class="enemy_type_icon" src="img/thunder.webp"><input type="text" id="enemy_element_3" class="enemy_type_value" readonly></div>
            <div class="light"><input type="image" class="enemy_type_icon" src="img/light.webp"><input type="text" id="enemy_element_4" class="enemy_type_value" readonly></div>
            <div class="dark"><input type="image" class="enemy_type_icon" src="img/dark.webp"><input type="text" id="enemy_element_5" class="enemy_type_value" readonly></div>
          </div>
        </div>
        <br>
        <div class="w-64 mx-auto text-center">
          <input type="button" id="calc" href="javascript:void(0)" class="calc_btn" value="計 算">
        </div>
        <br>
        <div id="damage_result" class="text-center hidden">
          <label class="damage_label">クリティカルダメージ</label><label id="critical_rate" class="damage_label"></label>
          <div>
            <input type="text" id="critical_damage_min"class="text-center min_damage" readonly>
            ～
            <input type="text" id="critical_damage" class="text-center damage" readonly>
            ～
            <input type="text" id="critical_damage_max"class="text-center min_damage" readonly>
          </div>
          <label class="damage_label">通常ダメージ</label>
          <div>
            <input type="text" id="damage_min" class="text-center min_damage" readonly>
            ～
            <input type="text" id="damage" class="text-center damage" readonly>
            ～
            <input type="text" id="damage_max"class="text-center min_damage" readonly>
          </div>
        </div>
      </div>
      <div>
        <div class="mx-auto text-center">
          <table>
            <colgroup>
              <col width="85px">
              <col width="100px">
              <col width="300px">
              <col width="58px">
            </colgroup>
            <tr>
              <td rowspan="8" class="kind">バフ</td>
              <td class="type">攻撃力アップ1</td>
              <td><select id="power_up1" class="buff power_up include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="power_up1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type">攻撃力アップ2</td>
              <td><select id="power_up2" class="buff power_up include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="power_up2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element">属性攻撃力アップ1</td>
              <td class="row_element"><select id="element_up1" class="buff element_up element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="element_up1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element">属性攻撃力アップ2</td>
              <td class="row_element"><select id="element_up2" class="buff element_up element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="element_up2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_weak">心眼1</td>
              <td class="row_weak"><select id="mindeye1" class="buff mindeye include_lv"><option selected value="">無し</option></select></td>
              <td class="row_weak"><div class="lv"><select id="mindeye1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_weak">心眼2</td>
              <td class="row_weak"><select id="mindeye2" class="buff mindeye include_lv"><option selected value="">無し</option></select></td>
              <td class="row_weak"><div class="lv"><select id="mindeye2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type">連撃1</td>
              <td><select id="funnel1" class="buff funnel include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="funnel1_lv"></select></div></td>
            </tr>
            <tr>
              <td class="type">連撃2</td>
              <td><select id="funnel2" class="buff funnel include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="funnel2_lv"></select></div></td>
            </tr>            <tr>
              <td rowspan="8" class="kind">デバフ</td>
              <td class="type">防御力ダウン1</td>
              <td><select id="defense_down1" class="debuff defense_down include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="defense_down1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type">防御力ダウン2</td>
              <td><select id="defense_down2" class="debuff defense_down include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="defense_down2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type">DP防御力ダウン1</td>
              <td><select id="dp_defense_down1" class="debuff dp_defense_down include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="dp_defense_down1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type">DP防御力ダウン2</td>
              <td><select id="dp_defense_down2" class="debuff dp_defense_down include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="dp_defense_down2_lv" class="lv_effect"></select></div></td>
            </tr>            
            <tr>
              <td class="type row_element">属性防御力ダウン1</td>
              <td class="row_element"><select id="element_down1" class="debuff element_down element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="element_down1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element">属性防御力ダウン2</td>
              <td class="row_element"><select id="element_down2" class="debuff element_down element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="element_down2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_weak">脆弱1</td>
              <td class="row_weak"><select id="fragile1" class="debuff fragile include_lv"><option selected value="">無し</option></select></td>
              <td class="row_weak"><div class="lv"><select id="fragile1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_weak">脆弱2</td>
              <td class="row_weak"><select id="fragile2" class="debuff fragile include_lv"><option selected value="">無し</option></select></td>
              <td class="row_weak"><div class="lv"><select id="fragile2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td rowspan="8" class="kind">クリティカル</td>
              <td>クリティカル率アップ1</td>
              <td><select id="critical_up1" class="critical_rate critical_up include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="critical_up1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type">クリティカル率アップ2</td>
              <td><select id="critical_up2" class="critical_rate critical_up include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="critical_up2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type">クリダメアップ1</td>
              <td><select id="critical_damege1" class="critical_buff critical_damege include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="critical_damege1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type">クリダメアップ2</td>
              <td><select id="critical_damege2" class="critical_buff critical_damege include_lv"><option selected value="">無し</option></select></td>
              <td><div class="lv"><select id="critical_damege2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element">属性クリ率アップ1</td>
              <td class="row_element"><select id="critical_element1" class="critical_rate critical_element element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="critical_element1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element">属性クリ率アップ2</td>
              <td class="row_element"><select id="critical_element2" class="critical_rate critical_element element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="critical_element2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element">属性クリダメアップ1</td>
              <td class="row_element"><select id="critical_damege_element1" class="critical_buff critical_damege_element element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="critical_damege_element1_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="type row_element">属性クリダメアップ2</td>
              <td class="row_element"><select id="critical_damege_element2" class="critical_buff critical_damege_element element include_lv"><option selected value="">無し</option></select></td>
              <td class="row_element"><div class="lv"><select id="critical_damege_element2_lv" class="lv_effect"></select></div></td>
            </tr>
            <tr>
              <td class="kind row_element">フィールド</td>
              <td class="type row_element">属性フィールド</td>
              <td class="row_element"><select id="element_field" class="buff filed element_field element"><option selected value="">無し</option></select></td>
              <td class="row_element" id="filed_lv"></td>
            </tr>
            <tr>
              <td class="kind">チャージ</td>
              <td class="type">チャージ</td>
              <td class=""><select id="charge" class="buff charge"><option selected value="">無し</option></select></td>
              <td class="" id="filed_lv"></td>
            </tr>
            <tr>
              <td class="kind">その他</td>
              <td class="text-lg" colspan="3" >
                <label class=""><input type="checkbox" id="fightingspirit" class="">闘志</label>
                <label class=""><input type="checkbox" id="misfortune" class="">厄</label>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="modal_layer">
    <div class="modal_layer_mask"></div>
    <div class="modal_layer_inner">
      <div class="modal_section">
        <div class="modal">
          <div class="modal_inner">
            <div class="modal_inner_headline">
              <div class="flex justify-center leading-10">
                <div>スタイル選択</div>
                <input type="button" id="calc" href="javascript:void(0)" class="remove_btn text-center absolute right-1" value="外す">
              </div>
            </div>
            <hr class="line"/>
            <div class="flex">
              <div class="w-8"></div>
              <input type="image" class="narrow physical" id="physical_1" src="img/slash.webp" data-select="1">
              <input type="image" class="narrow physical" id="physical_2" src="img/stab.webp" data-select="1">
              <input type="image" class="narrow physical" id="physical_3" src="img/strike.webp" data-select="1">
              <div class="w-16"></div>
              <input type="image" class="narrow element" id="element_0" src="img/none.webp" data-select="1">
              <input type="image" class="narrow element" id="element_1" src="img/fire.webp" data-select="1">
              <input type="image" class="narrow element" id="element_2" src="img/ice.webp" data-select="1">
              <input type="image" class="narrow element" id="element_3" src="img/thunder.webp" data-select="1">
              <input type="image" class="narrow element" id="element_4" src="img/light.webp" data-select="1">
              <input type="image" class="narrow element" id="element_5" src="img/dark.webp" data-select="1">
            </div>
            <div class="flex">
              <input type="button" class="narrow role" id="role_1" value="ATTACKER" data-select="1">
              <input type="button" class="narrow role" id="role_2" value="BREAKER" data-select="1">
              <input type="button" class="narrow role" id="role_3" value="BLASTER" data-select="1">
              <input type="button" class="narrow role" id="role_4" value="HEALER" data-select="1">
              <input type="button" class="narrow role" id="role_5" value="BUFFER" data-select="1">
              <input type="button" class="narrow role" id="role_6" value="DEBUFFER" data-select="1">
              <input type="button" class="narrow role" id="role_7" value="DEFENDER" data-select="1">
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31a.webp">
              <div id="sytle_list_31A" class="grid grid-cols-8 troops_31A"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31b.webp">
              <div id="sytle_list_31B" class="grid grid-cols-8 troops_31B"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31c.webp">
              <div id="sytle_list_31C" class="grid grid-cols-8 troops_31C"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31d.webp">
              <div id="sytle_list_31D" class="grid grid-cols-8 troops_31D"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31e.webp">
              <div id="sytle_list_31E" class="grid grid-cols-8 troops_31E"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31f.webp">
              <div id="sytle_list_31F" class="grid grid-cols-8 troops_31F"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/31x.webp">
              <div id="sytle_list_31X" class="grid grid-cols-8 troops_31X"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/30g.webp">
              <div id="sytle_list_30G" class="grid grid-cols-8 troops_30G"></div>
            </div>
            <div class="troops">
              <input type="image" class="emblem" src="img/angelbeats.webp">
              <div id="sytle_list_AB" class="grid grid-cols-8  troops_AB"></div>
            </div>
          </div>
          <br>
        </div>
      </div>
    </div>
  </div>
  <footer>
  </footer>
</body>
</html>
